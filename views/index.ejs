<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tareas</title>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Lista de Tareas</h1>
            <button id="themeToggle" class="theme-btn">ðŸŒ™ Cambiar Tema</button>
        </div>
        <a href="/add" class="add-btn">AÃ±adir Tarea</a>
        <ul class="task-list">
            <% tasks.forEach(task=> { %>
                <li class="task-item">
                    <h2>
                        <%= task.title %>
                    </h2>
                    <p>
                        <%= task.description %>
                    </p>
                    <div class="task-actions">
                        <a href="/edit/<%= task.id %>" class="edit-btn">Editar</a>
                        <button onclick="showDeleteModal(<%= task.id %>)" class="delete-btn">Eliminar</button>
                    </div>
                </li>
                <% }) %>
        </ul>
    </div>

    <!-- Modal de confirmaciÃ³n -->
    <div id="deleteModal" class="modal hidden">
        <div class="modal-content">
            <h2>Confirmar EliminaciÃ³n</h2>
            <p>Â¿EstÃ¡s seguro de que quieres eliminar esta tarea?</p>
            <div class="modal-actions">
                <button onclick="cancelDelete()" class="cancel-btn">Cancelar</button>
                <form id="deleteForm" action="" method="POST" class="inline">
                    <button type="submit" class="confirm-btn">Confirmar</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Modal de eliminaciÃ³n
        function showDeleteModal(taskId) {
            console.log('Mostrando modal para tarea ID:', taskId); // Log para depuraciÃ³n
            const modal = document.getElementById('deleteModal');
            const form = document.getElementById('deleteForm');
            form.action = `/delete/${taskId}`;
            modal.classList.remove('hidden');
        }

        function cancelDelete() {
            console.log('Cerrando modal'); // Log para depuraciÃ³n
            const modal = document.getElementById('deleteModal');
            modal.classList.add('hidden');
        }

        // Cambio de tema
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const currentTheme = localStorage.getItem('theme') || 'light';
        body.classList.add(currentTheme + '-theme');
        updateThemeButton();

        themeToggle.addEventListener('click', () => {
            const isLightTheme = body.classList.contains('light-theme');
            body.classList.replace(
                isLightTheme ? 'light-theme' : 'dark-theme',
                isLightTheme ? 'dark-theme' : 'light-theme'
            );
            localStorage.setItem('theme', isLightTheme ? 'dark' : 'light');
            updateThemeButton();
        });

        function updateThemeButton() {
            const isLightTheme = body.classList.contains('light-theme');
            themeToggle.textContent = isLightTheme ? 'ðŸŒ™ Cambiar a Oscuro' : 'â˜€ï¸ Cambiar a Claro';
        }

        // Asegurar que el modal estÃ© oculto al cargar la pÃ¡gina
        document.addEventListener('DOMContentLoaded', () => {
            console.log('PÃ¡gina cargada, asegurando que el modal estÃ© oculto'); // Log para depuraciÃ³n
            const modal = document.getElementById('deleteModal');
            modal.classList.add('hidden');
        });
    </script>
</body>

</html>